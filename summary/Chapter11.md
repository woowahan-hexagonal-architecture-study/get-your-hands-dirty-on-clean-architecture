# 11. 의식적으로 지름길 이용하기

- 지름길을 방지하기 위해서는 먼저 지름길 자체를 파악해야함
- 어떤 때는 지름길을 갔다가 나중에 고치는 것이 더 경제적일 수도 있음

# 왜 지름길은 깨진 창문 같을까?

>💡 **깨진 창문 이론**
어떤 것이 멈춘 것처럼 보이고, 망가져 보이고, [부정적인 형용사를 넣어보자], 혹은 관리되지 않는다고 여겨지면 인간의 뇌는 이를 더 멈추고, 망가뜨리고, [부정적인 형용사를 넣어보자] 해도 된다고 생각하게 된다.
>

위 이론을 코드에 적용하면?!

- 품질이 떨어진 코드에서 작업할 때 더 낮은 품질의 코드를 추가하기가 쉽다
- 코딩 규칙을 많이 어긴 코드에서 작업할 때 또 다른 규칙을 어기기도 쉽다
- 지름길을 많이 사용한 코드에서 작업할 때 또 다른 지름길을 추가하기도 쉽다

**⇒ 그래서 레거시가 그랬구나🤭**

# 깨끗한 상태로 시작할 책임

- 가능한 지름길을 쓰지 않고 기술 부채를 지지 않은 채로 프로젝트를 깨끗하게 시작하는 것이 중요함!
- 인계받은 프로젝트는 깨진 창문이 만들어지기 쉽다
- 때로는 지름길이 나을 수도 있는데, 의도적인 지름길에 대해서는 세심하게 잘 기록해둬야한다
    - ex. 아키텍처 결정 기록 (Architecture Decision Records, ADRs)
    - 문서에 대해 인지하고 있다면 지름길이 합리적으로 도출 되었음을 알 수 있음

헥사고날에서 어떤 의도적인 지름길을 쓸 수 있을까?!

# 지름길1. 유스케이스 간 모델 공유하기

- 유스케이스마다 입력 파라미터의 타입과 반환값의 타입은 달라야한다.
    - 유스케이스 간에 입출력 모델을 공유하게 되면, 유스케이스 사이에 결합이 생김
    
    ![Untitled](/images/chapter11/Untitled.png)
    
    - `SendMoneyUseCase`와 `RevokeActivityUseCase`가 결합됨
    - `SendMoneyCommand`가 변경되면 두 유스케이스 모두 영향을 받는다.
    - 변경할 이유를 공유하여 출력 모델을 공유함
- 유스케이스들이 기능적으로 묶여 있을 때 입출력 모델을 공유할 수 있음

**⇒ 특정 세부사항을 변경할 경우 실제로 두 유스케이스에 다 영향을 주고싶을 경우**


>💡 독립적이어야하나요 ? → YES → 입출력 모델 분리

- 나중에라도 독립적으로 가야하면 복붙을 하더라도 일단 분리하는 것이 맞다!
>

# 지름길2. 도메인 엔티티를 입출력 모델로 사용하기

![Untitled](/images/chapter11/Untitled%201.png)

- `SendMoneyUseCase`가 바뀌면 `Account`도 바뀌어야할 수도 있음
    - ex. `Account`에 없는 컬럼 정보를 유스케이스가 필요로한다면? → 필드를 추가하고싶어짐…
- 간단한 생성이나 업데이트 유스케이스에서는 도메인 엔티티가 있어도 괜찮을 수 있음
- 필드 몇 개를 업데이트하는 수준이 아니라 더 복잡한 로직을 구현해야한다면, 유스케이스 인터페이스에 대한 전용 입출력 모델을 만들어야함 (→ 도메인 로직의 일부를 풍부한 도메인 엔티티로 위임)
- 나중에 유스케이스가 도메인 로직 괴물이 되어갈 수 있음
    - 극단적인 빈약한 도메인 엔티티?
    - 최소기능제품으로 시작했다가 복잡도를 높여가는 환경에서는 더 심함

>💡 도메인 엔티티를 입출력 모델로 사용했더라도 도메인 모델로부터 독립적인 전용 입력 모델로 교체해야하는 시점을 잘 파악해야함
>

# 지름길3. 인커밍 포트 건너뛰기

![Untitled](/images/chapter11/Untitled%202.png)

- 인커밍포트는 의존성 역전에 필수적이진 않다 (아웃고잉은 필수적임)
- 그러면 추상화 계층을 줄였으니까 좋은거 아닐까?

### 인커핑 포트가 필요한 이유

1. 인커밍 포트가 없으면 도메인 로직의 진입점이 불분명해짐
    - 특정 유스케이스를 구현하기 위해 어떤 서비스 메서드를 호출해야 할지 알아내기 위해 애플리케이션의 내부 동작에 대해 더 잘알아야함
2. 인커밍 포트가 있어야 아키텍처를 쉽게 강제할 수 있음
    - 인커밍 어댑터가 애플리케이션 서비스가 아닌 인커밍 포트만 호출하게 할 수 있음
    - 호출할 의도가 없던 서비스 메서드를 실수로 호출할 일이 없음


>💡 어플리케이션 규모가 커질수록 인커밍 어댑터가 늘어날 것이니, 되도록 안 건너뛰는게 낫다!
>

# 지름길4. 애플리케이션 서비스 건너뛰기

(오..약간 파격적인걸…)

![Untitled](/images/chapter11/Untitled%203.png)

- 애플리케이션 서비스가 없으면 도메인 로직을 둘 것이 없다
- 간단한 CRUD는 바로 영속성 어댑터에 꽂으면 되며 영속성 어댑터가 직접 유스케이스 구현
- 인커밍 어댑터와 아웃고잉 어댑터 사이에 모델을 공유해야함 ← 도메인 모델을 입력 모델로 사용하는 케이스
- 유스케이스라 할 만한 것이 없어짐
    - 도메인 로직이 흩어져서 로직을 찾거나 유지보수하는 것이 어려워짐

# 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

- 경제적인 관점과 유지보수/확장 관점 사이에서 지름길의 사용 여부를 잘 결정해야한다
- 작게 시작했던 유스케이스가 단순 CRUD 상태를 벗어나는 시점이 언젠지 팀이 합의해야함
- (중요) 왜 특정 지름길을 선택했는지에 대한 기록을 남겨야함
    - 그래야 나중에 재논의도 가능함

**⇒ 팀의 합의가 중요함**